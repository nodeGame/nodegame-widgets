<!DOCTYPE html>
<html>
<head>
  <title>ChernoffFacesSimple.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../";
    var thisFile = "widgets/ChernoffFacesSimple.js";
    var defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#chernofffacessimple">ChernoffFacesSimple</a>
      </div>

      <div class="heading h2">
        <a href="#defaults">Defaults</a>
      </div>

      <div class="heading h2">
        <a href="#meta-data">Meta-data</a>
      </div>

      <div class="heading h2">
        <a href="#dependencies">Dependencies</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="chernofffacessimple">
  <h1>
    <a href="#chernofffacessimple" name="chernofffacessimple" class="pilcrow"></a>
ChernoffFacesSimple
  </h1>
</div>
<p>Copyright(c) 2017 Stefano Balietti <a href="mailto:ste@nodegame.org.html">ste@nodegame.org</a>
MIT Licensed</p>
</div>
<div class="body">
<p>Displays multidimensional data in the shape of a Chernoff Face.</p>
<p>www.nodegame.org</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
<span class="hljs-meta">
    "use strict"</span>;

    <span class="hljs-keyword">var</span> Table = W.Table;

    node.widgets.register(<span class="hljs-string">'ChernoffFacesSimple'</span>, ChernoffFaces);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="defaults">
  <h2>
    <a href="#defaults" name="defaults" class="pilcrow"></a>
Defaults
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
    ChernoffFaces.defaults = {};
    ChernoffFaces.defaults.id = <span class="hljs-string">'ChernoffFaces'</span>;
    ChernoffFaces.defaults.canvas = {};
    ChernoffFaces.defaults.canvas.width = <span class="hljs-number">100</span>;
    ChernoffFaces.defaults.canvas.heigth = <span class="hljs-number">100</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="meta-data">
  <h2>
    <a href="#meta-data" name="meta-data" class="pilcrow"></a>
Meta-data
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
    ChernoffFaces.version = <span class="hljs-string">'0.4'</span>;
    ChernoffFaces.description =
        <span class="hljs-string">'Display parametric data in the form of a Chernoff Face.'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="dependencies">
  <h2>
    <a href="#dependencies" name="dependencies" class="pilcrow"></a>
Dependencies
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    ChernoffFaces.dependencies = {
        <span class="hljs-attr">JSUS</span>: {},
        <span class="hljs-attr">Table</span>: {},
        <span class="hljs-attr">Canvas</span>: {},
        <span class="hljs-string">'Controls.Slider'</span>: {}
    };

    ChernoffFaces.FaceVector = FaceVector;
    ChernoffFaces.FacePainter = FacePainter;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ChernoffFaces</span> (<span class="hljs-params">options</span>) </span>{
        <span class="hljs-keyword">this</span>.options = options;
        <span class="hljs-keyword">this</span>.id = options.id;
        <span class="hljs-keyword">this</span>.table = <span class="hljs-keyword">new</span> Table({<span class="hljs-attr">id</span>: <span class="hljs-string">'cf_table'</span>});
        <span class="hljs-keyword">this</span>.root = options.root || <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
        <span class="hljs-keyword">this</span>.root.id = <span class="hljs-keyword">this</span>.id;

        <span class="hljs-keyword">this</span>.sc = node.widgets.get(<span class="hljs-string">'Controls.Slider'</span>);  <span class="hljs-comment">// Slider Controls</span>
        <span class="hljs-keyword">this</span>.fp = <span class="hljs-literal">null</span>;         <span class="hljs-comment">// Face Painter</span>
        <span class="hljs-keyword">this</span>.canvas = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">this</span>.dims = <span class="hljs-literal">null</span>;       <span class="hljs-comment">// width and height of the canvas</span>

        <span class="hljs-keyword">this</span>.change = <span class="hljs-string">'CF_CHANGE'</span>;
        <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">this</span>.changeFunc = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            that.draw(that.sc.getAllValues());
        };

        <span class="hljs-keyword">this</span>.features = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">this</span>.controls = <span class="hljs-literal">null</span>;
    }

    ChernoffFaces.prototype.init = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
        <span class="hljs-keyword">this</span>.id = options.id || <span class="hljs-keyword">this</span>.id;
        <span class="hljs-keyword">var</span> PREF = <span class="hljs-keyword">this</span>.id + <span class="hljs-string">'_'</span>;

        <span class="hljs-keyword">this</span>.features = options.features || <span class="hljs-keyword">this</span>.features ||
            FaceVector.random();

        <span class="hljs-keyword">this</span>.controls = (<span class="hljs-string">'undefined'</span> !== <span class="hljs-keyword">typeof</span> options.controls) ?
                        options.controls : <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">var</span> idCanvas = (options.idCanvas) ? options.idCanvas : PREF + <span class="hljs-string">'canvas'</span>;

        <span class="hljs-keyword">this</span>.dims = {
            <span class="hljs-attr">width</span>:  options.width ?
                options.width : ChernoffFaces.defaults.canvas.width,
            <span class="hljs-attr">height</span>: options.height ?
                options.height : ChernoffFaces.defaults.canvas.heigth
        };

        <span class="hljs-keyword">this</span>.canvas = W.getCanvas(idCanvas, <span class="hljs-keyword">this</span>.dims);
        <span class="hljs-keyword">this</span>.fp = <span class="hljs-keyword">new</span> FacePainter(<span class="hljs-keyword">this</span>.canvas);
        <span class="hljs-keyword">this</span>.fp.draw(<span class="hljs-keyword">new</span> FaceVector(<span class="hljs-keyword">this</span>.features));

        <span class="hljs-keyword">var</span> sc_options = {
            <span class="hljs-attr">id</span>: <span class="hljs-string">'cf_controls'</span>,
            <span class="hljs-attr">features</span>:
                J.mergeOnKey(FaceVector.defaults, <span class="hljs-keyword">this</span>.features, <span class="hljs-string">'value'</span>),
            <span class="hljs-attr">change</span>: <span class="hljs-keyword">this</span>.change,
            <span class="hljs-attr">fieldset</span>: {<span class="hljs-attr">id</span>: <span class="hljs-keyword">this</span>.id + <span class="hljs-string">'_controls_fieldest'</span>,
                       <span class="hljs-attr">legend</span>: <span class="hljs-keyword">this</span>.controls.legend || <span class="hljs-string">'Controls'</span>
                      },
            <span class="hljs-attr">submit</span>: <span class="hljs-string">'Send'</span>
        };

        <span class="hljs-keyword">this</span>.sc = node.widgets.get(<span class="hljs-string">'Controls.Slider'</span>, sc_options);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Controls are always there, but may not be visible</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.controls) {
            <span class="hljs-keyword">this</span>.table.add(<span class="hljs-keyword">this</span>.sc);
        }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Dealing with the onchange event</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-string">'undefined'</span> === <span class="hljs-keyword">typeof</span> options.change) {
            node.on(<span class="hljs-keyword">this</span>.change, <span class="hljs-keyword">this</span>.changeFunc);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (options.change) {
                node.on(options.change, <span class="hljs-keyword">this</span>.changeFunc);
            }
            <span class="hljs-keyword">else</span> {
                node.removeListener(<span class="hljs-keyword">this</span>.change, <span class="hljs-keyword">this</span>.changeFunc);
            }
            <span class="hljs-keyword">this</span>.change = options.change;
        }


        <span class="hljs-keyword">this</span>.table.add(<span class="hljs-keyword">this</span>.canvas);
        <span class="hljs-keyword">this</span>.table.parse();
        <span class="hljs-keyword">this</span>.root.appendChild(<span class="hljs-keyword">this</span>.table.table);
    };

    ChernoffFaces.prototype.getRoot = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.root;
    };

    ChernoffFaces.prototype.getCanvas = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.canvas;
    };

    ChernoffFaces.prototype.append = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">root</span>) </span>{
        root.appendChild(<span class="hljs-keyword">this</span>.root);
        <span class="hljs-keyword">this</span>.table.parse();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.root;
    };

    ChernoffFaces.prototype.listeners = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};

    ChernoffFaces.prototype.draw = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">features</span>) </span>{
        <span class="hljs-keyword">if</span> (!features) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">var</span> fv = <span class="hljs-keyword">new</span> FaceVector(features);
        <span class="hljs-keyword">this</span>.fp.redraw(fv);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Without merging wrong values are passed as attributes</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.sc.init({
            <span class="hljs-attr">features</span>: J.mergeOnKey(FaceVector.defaults, features, <span class="hljs-string">'value'</span>)
        });
        <span class="hljs-keyword">this</span>.sc.refresh();
    };

    ChernoffFaces.prototype.getAllValues = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>if (this.sc) return this.sc.getAllValues();</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fp.face;
    };

    ChernoffFaces.prototype.randomize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> fv = FaceVector.random();
        <span class="hljs-keyword">this</span>.fp.redraw(fv);

        <span class="hljs-keyword">var</span> sc_options = {
            <span class="hljs-attr">features</span>: J.mergeOnKey(FaceVector.defaults, fv, <span class="hljs-string">'value'</span>),
            <span class="hljs-attr">change</span>: <span class="hljs-keyword">this</span>.change
        };
        <span class="hljs-keyword">this</span>.sc.init(sc_options);
        <span class="hljs-keyword">this</span>.sc.refresh();

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>FacePainter
The class that actually draws the faces on the Canvas</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">FacePainter</span>(<span class="hljs-params">canvas, settings</span>) </span>{
        <span class="hljs-keyword">this</span>.canvas = <span class="hljs-keyword">new</span> W.Canvas(canvas);
        <span class="hljs-keyword">this</span>.scaleX = canvas.width / ChernoffFaces.defaults.canvas.width;
        <span class="hljs-keyword">this</span>.scaleY = canvas.height / ChernoffFaces.defaults.canvas.heigth;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Draws a Chernoff face.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    FacePainter.prototype.draw = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face, x, y</span>) </span>{
        <span class="hljs-keyword">if</span> (!face) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">this</span>.face = face;
        <span class="hljs-keyword">this</span>.fit2Canvas(face);
        <span class="hljs-keyword">this</span>.canvas.scale(face.scaleX, face.scaleY);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>console.log('Face Scale ' + face.scaleY + ' ' + face.scaleX );</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
        x = x || <span class="hljs-keyword">this</span>.canvas.centerX;
        y = y || <span class="hljs-keyword">this</span>.canvas.centerY;

        <span class="hljs-keyword">this</span>.drawHead(face, x, y);

        <span class="hljs-keyword">this</span>.drawEyes(face, x, y);

        <span class="hljs-keyword">this</span>.drawPupils(face, x, y);

        <span class="hljs-keyword">this</span>.drawEyebrow(face, x, y);

        <span class="hljs-keyword">this</span>.drawNose(face, x, y);

        <span class="hljs-keyword">this</span>.drawMouth(face, x, y);

    };

    FacePainter.prototype.redraw = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face, x, y</span>) </span>{
        <span class="hljs-keyword">this</span>.canvas.clear();
        <span class="hljs-keyword">this</span>.draw(face,x,y);
    };

    FacePainter.prototype.scale = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, y</span>) </span>{
        <span class="hljs-keyword">this</span>.canvas.scale(<span class="hljs-keyword">this</span>.scaleX, <span class="hljs-keyword">this</span>.scaleY);
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>TODO: Improve. It eats a bit of the margins</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    FacePainter.prototype.fit2Canvas = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face</span>) </span>{
        <span class="hljs-keyword">var</span> ratio;
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.canvas) {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'No canvas found'</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.canvas.width &gt; <span class="hljs-keyword">this</span>.canvas.height) {
            ratio = <span class="hljs-keyword">this</span>.canvas.width / face.head_radius * face.head_scale_x;
        }
        <span class="hljs-keyword">else</span> {
            ratio = <span class="hljs-keyword">this</span>.canvas.height / face.head_radius * face.head_scale_y;
        }

        face.scaleX = ratio / <span class="hljs-number">2</span>;
        face.scaleY = ratio / <span class="hljs-number">2</span>;
    };

    FacePainter.prototype.drawHead = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face, x, y</span>) </span>{

        <span class="hljs-keyword">var</span> radius = face.head_radius;

        <span class="hljs-keyword">this</span>.canvas.drawOval({
            <span class="hljs-attr">x</span>: x,
            <span class="hljs-attr">y</span>: y,
            <span class="hljs-attr">radius</span>: radius,
            <span class="hljs-attr">scale_x</span>: face.head_scale_x,
            <span class="hljs-attr">scale_y</span>: face.head_scale_y,
            <span class="hljs-attr">color</span>: face.color,
            <span class="hljs-attr">lineWidth</span>: face.lineWidth
        });
    };

    FacePainter.prototype.drawEyes = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face, x, y</span>) </span>{

        <span class="hljs-keyword">var</span> height = FacePainter.computeFaceOffset(face, face.eye_height, y);
        <span class="hljs-keyword">var</span> spacing = face.eye_spacing;

        <span class="hljs-keyword">var</span> radius = face.eye_radius;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>console.log(face);</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.canvas.drawOval({
            <span class="hljs-attr">x</span>: x - spacing,
            <span class="hljs-attr">y</span>: height,
            <span class="hljs-attr">radius</span>: radius,
            <span class="hljs-attr">scale_x</span>: face.eye_scale_x,
            <span class="hljs-attr">scale_y</span>: face.eye_scale_y,
            <span class="hljs-attr">color</span>: face.color,
            <span class="hljs-attr">lineWidth</span>: face.lineWidth

        });
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>console.log(face);</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.canvas.drawOval({
            <span class="hljs-attr">x</span>: x + spacing,
            <span class="hljs-attr">y</span>: height,
            <span class="hljs-attr">radius</span>: radius,
            <span class="hljs-attr">scale_x</span>: face.eye_scale_x,
            <span class="hljs-attr">scale_y</span>: face.eye_scale_y,
            <span class="hljs-attr">color</span>: face.color,
            <span class="hljs-attr">lineWidth</span>: face.lineWidth
        });
    };

    FacePainter.prototype.drawPupils = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face, x, y</span>) </span>{

        <span class="hljs-keyword">var</span> radius = face.pupil_radius;
        <span class="hljs-keyword">var</span> spacing = face.eye_spacing;
        <span class="hljs-keyword">var</span> height = FacePainter.computeFaceOffset(face, face.eye_height, y);

        <span class="hljs-keyword">this</span>.canvas.drawOval({
            <span class="hljs-attr">x</span>: x - spacing,
            <span class="hljs-attr">y</span>: height,
            <span class="hljs-attr">radius</span>: radius,
            <span class="hljs-attr">scale_x</span>: face.pupil_scale_x,
            <span class="hljs-attr">scale_y</span>: face.pupil_scale_y,
            <span class="hljs-attr">color</span>: face.color,
            <span class="hljs-attr">lineWidth</span>: face.lineWidth
        });

        <span class="hljs-keyword">this</span>.canvas.drawOval({
            <span class="hljs-attr">x</span>: x + spacing,
            <span class="hljs-attr">y</span>: height,
            <span class="hljs-attr">radius</span>: radius,
            <span class="hljs-attr">scale_x</span>: face.pupil_scale_x,
            <span class="hljs-attr">scale_y</span>: face.pupil_scale_y,
            <span class="hljs-attr">color</span>: face.color,
            <span class="hljs-attr">lineWidth</span>: face.lineWidth
        });

    };

    FacePainter.prototype.drawEyebrow = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face, x, y</span>) </span>{

        <span class="hljs-keyword">var</span> height = FacePainter.computeEyebrowOffset(face,y);
        <span class="hljs-keyword">var</span> spacing = face.eyebrow_spacing;
        <span class="hljs-keyword">var</span> length = face.eyebrow_length;
        <span class="hljs-keyword">var</span> angle = face.eyebrow_angle;

        <span class="hljs-keyword">this</span>.canvas.drawLine({
            <span class="hljs-attr">x</span>: x - spacing,
            <span class="hljs-attr">y</span>: height,
            <span class="hljs-attr">length</span>: length,
            <span class="hljs-attr">angle</span>: angle,
            <span class="hljs-attr">color</span>: face.color,
            <span class="hljs-attr">lineWidth</span>: face.lineWidth


        });

        <span class="hljs-keyword">this</span>.canvas.drawLine({
            <span class="hljs-attr">x</span>: x + spacing,
            <span class="hljs-attr">y</span>: height,
            <span class="hljs-attr">length</span>: <span class="hljs-number">0</span>-length,
            <span class="hljs-attr">angle</span>: -angle,
            <span class="hljs-attr">color</span>: face.color,
            <span class="hljs-attr">lineWidth</span>: face.lineWidth
        });

    };

    FacePainter.prototype.drawNose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face, x, y</span>) </span>{

        <span class="hljs-keyword">var</span> height = FacePainter.computeFaceOffset(face, face.nose_height, y);
        <span class="hljs-keyword">var</span> nastril_r_x = x + face.nose_width / <span class="hljs-number">2</span>;
        <span class="hljs-keyword">var</span> nastril_r_y = height + face.nose_length;
        <span class="hljs-keyword">var</span> nastril_l_x = nastril_r_x - face.nose_width;
        <span class="hljs-keyword">var</span> nastril_l_y = nastril_r_y;

        <span class="hljs-keyword">this</span>.canvas.ctx.lineWidth = face.lineWidth;
        <span class="hljs-keyword">this</span>.canvas.ctx.strokeStyle = face.color;

        <span class="hljs-keyword">this</span>.canvas.ctx.save();
        <span class="hljs-keyword">this</span>.canvas.ctx.beginPath();
        <span class="hljs-keyword">this</span>.canvas.ctx.moveTo(x,height);
        <span class="hljs-keyword">this</span>.canvas.ctx.lineTo(nastril_r_x,nastril_r_y);
        <span class="hljs-keyword">this</span>.canvas.ctx.lineTo(nastril_l_x,nastril_l_y);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>this.canvas.ctx.closePath();</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.canvas.ctx.stroke();
        <span class="hljs-keyword">this</span>.canvas.ctx.restore();

    };

    FacePainter.prototype.drawMouth = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face, x, y</span>) </span>{

        <span class="hljs-keyword">var</span> height = FacePainter.computeFaceOffset(face, face.mouth_height, y);
        <span class="hljs-keyword">var</span> startX = x - face.mouth_width / <span class="hljs-number">2</span>;
        <span class="hljs-keyword">var</span> endX = x + face.mouth_width / <span class="hljs-number">2</span>;

        <span class="hljs-keyword">var</span> top_y = height - face.mouth_top_y;
        <span class="hljs-keyword">var</span> bottom_y = height + face.mouth_bottom_y;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>Upper Lip</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.canvas.ctx.moveTo(startX,height);
        <span class="hljs-keyword">this</span>.canvas.ctx.quadraticCurveTo(x, top_y, endX, height);
        <span class="hljs-keyword">this</span>.canvas.ctx.stroke();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>Lower Lip</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.canvas.ctx.moveTo(startX,height);
        <span class="hljs-keyword">this</span>.canvas.ctx.quadraticCurveTo(x, bottom_y, endX, height);
        <span class="hljs-keyword">this</span>.canvas.ctx.stroke();

    };


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>TODO Scaling ?</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    FacePainter.computeFaceOffset = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face, offset, y</span>) </span>{
        y = y || <span class="hljs-number">0</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>var pos = y - face.head_radius * face.scaleY +
face.head_radius * face.scaleY * 2 * offset;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">var</span> pos = y - face.head_radius + face.head_radius * <span class="hljs-number">2</span> * offset;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>console.log('POS: ' + pos);</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> pos;
    };

    FacePainter.computeEyebrowOffset = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face, y</span>) </span>{
        y = y || <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> eyemindistance = <span class="hljs-number">2</span>;
        <span class="hljs-keyword">return</span> FacePainter.computeFaceOffset(face, face.eye_height, y) -
            eyemindistance - face.eyebrow_eyedistance;
    };


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<div class="dox">
<div class="summary">
<p>!</p>
</div>
<div class="body">
<p>A description of a Chernoff Face.</p>
<p>This class packages the 11-dimensional vector of numbers from 0 through
1 that completely describe a Chernoff face.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">

    FaceVector.defaults = {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Head</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        head_radius: {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>id can be specified otherwise is taken head_radius</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            min: <span class="hljs-number">10</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">30</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Face radius'</span>
        },
        <span class="hljs-attr">head_scale_x</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0.2</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">0.5</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Scale head horizontally'</span>
        },
        <span class="hljs-attr">head_scale_y</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0.2</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Scale head vertically'</span>
        },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>Eye</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        eye_height: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0.1</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">0.9</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">0.4</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Eye height'</span>
        },
        <span class="hljs-attr">eye_radius</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">30</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">5</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Eye radius'</span>
        },
        <span class="hljs-attr">eye_spacing</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">50</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Eye spacing'</span>
        },
        <span class="hljs-attr">eye_scale_x</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0.2</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Scale eyes horizontally'</span>
        },
        <span class="hljs-attr">eye_scale_y</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0.2</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Scale eyes vertically'</span>
        },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>Pupil</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        pupil_radius: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">9</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">1</span>,  <span class="hljs-comment">//this.eye_radius;</span>
            label: <span class="hljs-string">'Pupil radius'</span>
        },
        <span class="hljs-attr">pupil_scale_x</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0.2</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Scale pupils horizontally'</span>
        },
        <span class="hljs-attr">pupil_scale_y</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0.2</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Scale pupils vertically'</span>
        },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>Eyebrow</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        eyebrow_length: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">30</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Eyebrow length'</span>
        },
        <span class="hljs-attr">eyebrow_eyedistance</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0.3</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// From the top of the eye</span>
            label: <span class="hljs-string">'Eyebrow from eye'</span>
        },
        <span class="hljs-attr">eyebrow_angle</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">-2</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">-0.5</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Eyebrow angle'</span>
        },
        <span class="hljs-attr">eyebrow_spacing</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">20</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">5</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Eyebrow spacing'</span>
        },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>Nose</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        nose_height: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0.4</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">0.4</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Nose height'</span>
        },
        <span class="hljs-attr">nose_length</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0.2</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">30</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">15</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Nose length'</span>
        },
        <span class="hljs-attr">nose_width</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">30</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Nose width'</span>
        },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>Mouth</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        mouth_height: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">0.2</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">0.75</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Mouth height'</span>
        },
        <span class="hljs-attr">mouth_width</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">20</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Mouth width'</span>
        },
        <span class="hljs-attr">mouth_top_y</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">-10</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">30</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">-2</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Upper lip'</span>
        },
        <span class="hljs-attr">mouth_bottom_y</span>: {
            <span class="hljs-attr">min</span>: <span class="hljs-number">-10</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">30</span>,
            <span class="hljs-attr">step</span>: <span class="hljs-number">0.01</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-number">20</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Lower lip'</span>
        }
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>Constructs a random face vector.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    FaceVector.random = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> out = {};
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> FaceVector.defaults) {
            <span class="hljs-keyword">if</span> (FaceVector.defaults.hasOwnProperty(key)) {
                <span class="hljs-keyword">if</span> (!J.inArray(key,
                            [<span class="hljs-string">'color'</span>, <span class="hljs-string">'lineWidth'</span>, <span class="hljs-string">'scaleX'</span>, <span class="hljs-string">'scaleY'</span>])) {

                    out[key] = FaceVector.defaults[key].min +
                        <span class="hljs-built_in">Math</span>.random() * FaceVector.defaults[key].max;
                }
            }
        }

        out.scaleX = <span class="hljs-number">1</span>;
        out.scaleY = <span class="hljs-number">1</span>;

        out.color = <span class="hljs-string">'green'</span>;
        out.lineWidth = <span class="hljs-number">1</span>;

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FaceVector(out);
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">FaceVector</span>(<span class="hljs-params">faceVector</span>) </span>{
        faceVector = faceVector || {};

        <span class="hljs-keyword">this</span>.scaleX = faceVector.scaleX || <span class="hljs-number">1</span>;
        <span class="hljs-keyword">this</span>.scaleY = faceVector.scaleY || <span class="hljs-number">1</span>;


        <span class="hljs-keyword">this</span>.color = faceVector.color || <span class="hljs-string">'green'</span>;
        <span class="hljs-keyword">this</span>.lineWidth = faceVector.lineWidth || <span class="hljs-number">1</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>Merge on key</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> FaceVector.defaults) {
            <span class="hljs-keyword">if</span> (FaceVector.defaults.hasOwnProperty(key)){
                <span class="hljs-keyword">if</span> (faceVector.hasOwnProperty(key)){
                    <span class="hljs-keyword">this</span>[key] = faceVector[key];
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>[key] = FaceVector.defaults[key].value;
                }
            }
        }

    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>Constructs a random face vector.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    FaceVector.prototype.shuffle = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hasOwnProperty(key)) {
                <span class="hljs-keyword">if</span> (FaceVector.defaults.hasOwnProperty(key)) {
                    <span class="hljs-keyword">if</span> (key !== <span class="hljs-string">'color'</span>) {
                        <span class="hljs-keyword">this</span>[key] = FaceVector.defaults[key].min +
                            <span class="hljs-built_in">Math</span>.random() * FaceVector.defaults[key].max;
                    }
                }
            }
        }
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Computes the Euclidean distance between two FaceVectors.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    FaceVector.prototype.distance = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face</span>) </span>{
        <span class="hljs-keyword">return</span> FaceVector.distance(<span class="hljs-keyword">this</span>,face);
    };


    FaceVector.distance = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">face1, face2</span>) </span>{
        <span class="hljs-keyword">var</span> sum = <span class="hljs-number">0.0</span>;
        <span class="hljs-keyword">var</span> diff;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> face1) {
            <span class="hljs-keyword">if</span> (face1.hasOwnProperty(key)) {
                diff = face1[key] - face2[key];
                sum = sum + diff * diff;
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.sqrt(sum);
    };

    FaceVector.prototype.toString = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> out = <span class="hljs-string">'Face: '</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hasOwnProperty(key)) {
                out += key + <span class="hljs-string">' '</span> + <span class="hljs-keyword">this</span>[key];
            }
        }
        <span class="hljs-keyword">return</span> out;
    };

})(node);

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
